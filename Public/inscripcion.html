<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Inscripción ▢ La Escuela del Espíritu Santo</title>
  <style>
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      background: linear-gradient(to bottom, #1e3a8a 0%, #3b82f6 40%, #93c5fd 100%);
      min-height: 100vh;
    }
    .page-shell {
      background: rgba(2, 6, 23, 0.6);
      min-height: 100vh;
      backdrop-filter: blur(6px);
      display: flex;
      flex-direction: column;
    }
    header {
      padding: 1rem 1.25rem .5rem;
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    .nav {
      max-width: 560px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }
    .brand { line-height: 1.3; }
    .brand strong { color: #fff; }
    .brand small { color: #d1d5db; }
    .brand a { color: #fbbf24; font-size:.72rem; text-decoration:none; }
    .back-link {
      color: rgba(226,232,240,0.85);
      font-size: .78rem;
      text-decoration: none;
    }
    .back-link:hover { color: #fbbf24; }
    .title-block {
      text-align: center;
      margin-top: 1.8rem;
      color: #fff;
    }
    .title-block h1 { margin: 0; font-size: 2.1rem; }
    .title-block p { margin-top: .4rem; color: rgba(226,232,240,.75); }
    main {
      max-width: 560px;
      margin: 0 auto;
      padding: 2rem 1.25rem 3.2rem;
      display: grid;
      gap: 1.25rem;
    }
    .box {
      background: rgba(15,23,42,.5);
      border: 1px solid rgba(255,255,255,.05);
      border-radius: 1rem;
      padding: 1.1rem 1rem 1rem;
      display: grid;
      gap: .65rem;
      color: #fff;
    }
    label { font-size: .8rem; }
    input {
      background: rgba(15,23,42,.28);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: .5rem;
      padding: .4rem .5rem;
      color: #fff;
      font-size: .8rem;
      width: 100%;
    }
    input:focus { outline: 1px solid rgba(251,191,36,.6); }
    .btn {
      background: linear-gradient(120deg, #f97316, #fbbf24);
      color: #020617;
      border: none;
      border-radius: .6rem;
      padding: .55rem .9rem;
      font-weight: 600;
      cursor: pointer;
      text-align: center;
      width: 100%;
      text-decoration: none;
      transition: all .2s ease;
    }
    .btn:disabled {
      opacity: .5;
      cursor: not-allowed;
    }
    .muted { color: rgba(226,232,240,0.8); }
    a { color: #fbbf24; text-decoration: none; }
    .error-msg {
      background: rgba(248,113,113,.08);
      border: 1px solid rgba(254,202,202,.15);
      border-radius: .45rem;
      padding: .35rem .5rem;
      font-size: .7rem;
      color: #fee2e2;
      display: none;
    }
    footer {
      text-align: center;
      padding: 1.25rem 1rem 2rem;
      color: rgba(226,232,240,.5);
      font-size: .7rem;
      margin-top: auto;
    }
  </style>
</head>
<body>
  <div class="page-shell">
    <header>
      <div class="nav">
        <div class="brand">
          <strong>La Escuela del Espíritu Santo</strong><br />
          <small>Ministerio Yo Soy La Vid Verdadera</small><br />
          <a href="https://iattv.org" target="_blank">IATTV.ORG</a>
        </div>

        <a class="back-link" href="./index.html">◀ Volver al inicio</a>
      </div>
    </header>

    <div class="title-block">
      <h1>Inscripción</h1>
      <p>Crea tu cuenta.</p>
      <p id="statusMsg" class="muted" style="display:none;"></p>
    </div>

    <main>
      <div class="box" id="formBox">
        <div id="errorBox" class="error-msg"></div>

        <form id="inscForm">
          <label for="nombre">Nombre completo</label>
          <input id="nombre" required />

          <label for="whatsapp">WhatsApp / teléfonos</label>
          <input id="whatsapp" placeholder="+1 954..." required />

          <label for="email">Correo electrónico</label>
          <input id="email" type="email" required />

          <label for="password">Crea una contraseña</label>
          <input id="password" type="password" placeholder="Mínimo 6 caracteres" required />

          <label for="pais">País</label>
          <input id="pais" placeholder="USA, Colombia, etc." />

          <button type="submit" class="btn" id="submitBtn" style="margin-top:.6rem;">
            Crear cuenta
          </button>
        </form>

        <small class="muted" style="font-size:.72rem;">
          ¿Ya tienes cuenta?
          <a href="./login.html">Inicia sesión aquí</a>.
        </small>
      </div>

    </main>

    <footer>
      <a class="btn footer-btn" href="./contacto.html">Contáctanos</a><br />
      <span id="year"></span> La Escuela del Espíritu Santo ▢ Ministerio Yo Soy La Vid Verdadera
    </footer>
  </div>

  <script type="module">
    document.getElementById('year').textContent = new Date().getFullYear();

    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import {
      getAuth,
      createUserWithEmailAndPassword
    } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
    import {
      getFirestore,
      doc,
      setDoc,
      serverTimestamp
    } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCJVZmCuM8bekhbG1AFMAcT3O8pncvoFcQ",
      authDomain: "escuela-ees.firebaseapp.com",
      projectId: "escuela-ees",
      storageBucket: "escuela-ees.firebasestorage.app",
      messagingSenderId: "514513764908",
      appId: "1:514513764908:web:56f9ca64edbe79f1f14789"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const form = document.getElementById("inscForm");
    const errorBox = document.getElementById("errorBox");
    const statusMsg = document.getElementById("statusMsg");
    const submitBtn = document.getElementById("submitBtn");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const nombre = document.getElementById("nombre").value.trim();
      const whatsapp = document.getElementById("whatsapp").value.trim();
      const email = document.getElementById("email").value.trim().toLowerCase();
      const password = document.getElementById("password").value.trim();
      const pais = document.getElementById("pais").value.trim();

      errorBox.style.display = "none";

      if (!nombre || !whatsapp || !email || !password) {
        errorBox.textContent = "Completa todos los campos obligatorios.";
        errorBox.style.display = "block";
        return;
      }

      submitBtn.disabled = true;
      submitBtn.textContent = "Creando cuenta…";

      try {
        const cred = await createUserWithEmailAndPassword(auth, email, password);
        const uid = cred.user.uid;

        const data = {
          nombre,
          whatsapp,
          email,
          pais,
          createdAt: serverTimestamp(),
          nombreLower: nombre.toLowerCase(),
          emailLower: email.toLowerCase()
        };

        await setDoc(doc(db, "users", uid), data, { merge: true });
        await setDoc(doc(db, "inscripciones", uid), data, { merge: true });

        statusMsg.style.display = "block";
        statusMsg.textContent = "✅ Cuenta creada. Redirigiendo…";

        window.location.href = "./materiales.html";

      } catch (err) {
        console.error(err);

        let msg = "Ocurrió un error al crear la cuenta.";
        if (err.code === "auth/email-already-in-use") {
          msg = "Este correo ya tiene cuenta registrada.";
        }
        if (err.code === "auth/weak-password") {
          msg = "Contraseña demasiado corta (mínimo 6 caracteres).";
        }

        errorBox.textContent = msg;
        errorBox.style.display = "block";
        submitBtn.disabled = false;
        submitBtn.textContent = "Crear cuenta";
      }
    });
  </script>

</body>
</html>
